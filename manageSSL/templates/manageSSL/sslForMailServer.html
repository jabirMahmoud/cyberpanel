{% extends "baseTemplate/index.html" %}
{% load i18n %}
{% load static %}
{% block title %}{% trans "Issue SSL For MailServer - CyberPanel" %}{% endblock %}

{% block header_scripts %}
<style>
    /* SSL Mail Server Page Specific Styles */
    .ssl-wrapper {
        background: transparent;
        padding: 20px;
    }
    
    .ssl-container {
        max-width: 1200px;
        margin: 0 auto;
    }
    
    .ssl-section {
        background: white;
        border-radius: 12px;
        padding: 25px;
        margin-bottom: 25px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        border: 1px solid #e8e9ff;
    }
    
    .section-title {
        font-size: 16px;
        font-weight: 700;
        color: #2f3640;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .section-title::before {
        content: '';
        width: 4px;
        height: 24px;
        background: #5b5fcf;
        border-radius: 2px;
    }
    
    .ssl-docs-link {
        background: #f8f9ff;
        border: 1px solid #e8e9ff;
        color: #5b5fcf;
        padding: 6px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-left: auto;
    }
    
    .ssl-docs-link:hover {
        background: #5b5fcf;
        color: white;
        border-color: #5b5fcf;
        box-shadow: 0 2px 4px rgba(91,95,207,0.3);
        text-decoration: none;
    }
    
    .ssl-description {
        color: #8893a7;
        font-size: 14px;
        margin-bottom: 25px;
        line-height: 1.5;
    }
    
    .deprecation-notice {
        background: #e3f2fd;
        border: 1px solid #bbdefb;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 25px;
        color: #1976d2;
        font-size: 14px;
    }
    
    .deprecation-notice a {
        color: #1976d2;
        font-weight: 600;
        text-decoration: underline;
    }
    
    .form-container {
        background: #fafbff;
        border: 1px solid #e8e9ff;
        border-radius: 8px;
        padding: 25px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .form-label {
        font-size: 13px;
        font-weight: 600;
        color: #2f3640;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .form-control {
        width: 100%;
        padding: 12px 16px;
        border: 1px solid #e8e9ff;
        border-radius: 8px;
        font-size: 14px;
        color: #2f3640;
        background: white;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        outline: none;
        border-color: #5b5fcf;
        box-shadow: 0 0 0 3px rgba(91,95,207,0.1);
    }
    
    .btn-primary {
        background: #5b5fcf;
        border: 1px solid #5b5fcf;
        color: white;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }
    
    .btn-primary:hover {
        background: #4b4fbf;
        border-color: #4b4fbf;
        box-shadow: 0 3px 8px rgba(91,95,207,0.3);
        transform: translateY(-1px);
    }
    
    .btn-primary:disabled {
        background: #94a3b8;
        border-color: #94a3b8;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    
    .alert {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .alert-success {
        background: #f0f9ff;
        border: 1px solid #bae6fd;
        color: #0c4a6e;
    }
    
    .alert-danger {
        background: #fef2f2;
        border: 1px solid #fecaca;
        color: #991b1b;
    }
    
    .loading-spinner {
        width: 16px;
        height: 16px;
        margin-left: 8px;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
        .ssl-wrapper {
            padding: 15px;
        }
        
        .ssl-section {
            padding: 20px;
        }
        
        .form-container {
            padding: 20px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="ssl-wrapper">
    <div class="ssl-container" ng-controller="sslIssueForMailServer">
        <!-- Header Section -->
        <div class="ssl-section">
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; gap: 15px;">
                <h2 class="section-title">SSL FOR MAIL SERVER</h2>
                <a href="http://go.cyberpanel.net/mailserver-ssl" target="_blank" class="ssl-docs-link">
                    <i class="fas fa-book"></i>
                    {% trans "SSL Docs" %}
                </a>
            </div>
            <p class="ssl-description">{% trans "Let's Encrypt SSL for MailServer (Postfix/Dovecot)." %}</p>
            
            <div ng-hide="success" class="deprecation-notice">
                <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                Note: This feature is deprecated in favour of <a href="/base/onboarding">setup-wizard</a>.
            </div>
        </div>

        <!-- SSL Form Section -->
        <div class="ssl-section">
            <h3 class="section-title">
                ISSUE SSL CERTIFICATE
                <img ng-hide="manageSSLLoading" src="{% static 'images/loading.gif' %}" class="loading-spinner">
            </h3>
            
            <div class="form-container">
                <div class="form-group">
                    <label class="form-label">{% trans "Select Website" %}</label>
                    <select ng-change="showbtn()" ng-model="virtualHost" class="form-control">
                        <option value="">-- Select a website --</option>
                        {% for items in websiteList %}
                            <option>{{ items }}</option>
                        {% endfor %}
                    </select>
                </div>

                <div ng-hide="issueSSLBtn" class="form-group">
                    <button type="button" ng-click="issueSSL()" class="btn-primary">
                        <i class="fas fa-lock"></i>
                        {% trans "Issue SSL" %}
                    </button>
                </div>

                <!-- Success/Error Messages -->
                <div ng-hide="canNotIssue" class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    <strong>{% trans "Cannot issue SSL." %}</strong> {% trans "Error message:" %} {$ errorMessage $}
                </div>

                <div ng-hide="sslIssued" class="alert alert-success">
                    <i class="fas fa-check-circle" style="margin-right: 8px;"></i>
                    <strong>{% trans "SSL Issued Successfully!" %}</strong><br>
                    {% trans "SSL Issued, your mail server now uses Lets Encrypt!" %}
                </div>

                <div ng-hide="couldNotConnect" class="alert alert-danger">
                    <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                    <strong>{% trans "Connection Error" %}</strong><br>
                    {% trans "Could not connect to server, please refresh this page." %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block footer_scripts %}
<script src="{% static 'manageSSL/manageSSL.js' %}"></script>
{% endblock %}